<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Room Demo</title>
<style>
body { font-family: Poppins, sans-serif; margin:0; background:#f5f5f5; text-align:center; }
h2 { margin-top:20px; }
.product-selector { margin:20px 0; }
button { padding:10px 20px; margin:0 10px; border:none; background:#1A237E; color:#fff; border-radius:5px; cursor:pointer; }
button:hover { background:#3949AB; }
#gallery { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; margin-top:20px; }
#gallery img { width:200px; border-radius:10px; cursor:pointer; transition: transform 0.3s; }
#gallery img:hover { transform:scale(1.05); }
#lightbox { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:9999; display:none; }
#lightbox-img { max-width:90%; max-height:80%; border-radius:10px; }
#close-lightbox { position:absolute; top:20px; right:30px; font-size:40px; color:#fff; cursor:pointer; }
#prev,#next { position:absolute; top:50%; font-size:60px; color:#fff; cursor:pointer; user-select:none; }
#prev { left:30px; } #next { right:30px; }
</style>
</head>
<body>

<h2>3D Room Furniture Demo</h2>

<div class="product-selector">
  <button data-folder="sofa">Sofa</button>
  <button data-folder="bed">Bed</button>
</div>

<div id="gallery"></div>

<!-- Lightbox -->
<div id="lightbox">
  <span id="close-lightbox">&times;</span>
  <img id="lightbox-img" src="">
  <div id="prev">&#10094;</div>
  <div id="next">&#10095;</div>
</div>

<script>
let images = [];
let currentIndex = 0;

const gallery = document.getElementById("gallery");
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightbox-img");
const closeBtn = document.getElementById("close-lightbox");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");

// Load images when a furniture button is clicked
document.querySelectorAll(".product-selector button").forEach(btn => {
  btn.addEventListener("click", async () => {
    const folder = btn.dataset.folder;
    gallery.innerHTML = "<p>Loading...</p>";

    try {
      const response = await fetch(`/api/images/${folder}`);
      if (!response.ok) throw new Error("Folder not found or empty");
      images = await response.json();

      gallery.innerHTML = "";
      images.forEach((imgSrc, index) => {
        const img = document.createElement("img");
        img.src = imgSrc;
        img.alt = folder + " image";
        img.addEventListener("click", () => openLightbox(index));
        gallery.appendChild(img);
      });

    } catch (err) {
      gallery.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    }
  });
});

// Lightbox functions
function openLightbox(index) {
  currentIndex = index;
  lightboxImg.src = images[currentIndex];
  lightbox.style.display = "flex";
}

closeBtn.addEventListener("click", () => lightbox.style.display = "none");

prevBtn.addEventListener("click", () => {
  currentIndex = (currentIndex - 1 + images.length) % images.length;
  lightboxImg.src = images[currentIndex];
});

nextBtn.addEventListener("click", () => {
  currentIndex = (currentIndex + 1) % images.length;
  lightboxImg.src = images[currentIndex];
});

lightbox.addEventListener("click", (e) => {
  if (e.target === lightbox) lightbox.style.display = "none";
});
</script>

</body>
</html>
